FROM openjdk:8-alpine
ARG CONFIG_DIR
VOLUME ["/sys/fs/cgroup"]
RUN apk add transmission-daemon transmission-cli openrc
RUN mkdir -p /home/media/torrent/downloads
RUN mkdir -p /home/media/torrent/complete
RUN mkdir -p /home/media/torrent/torrent_files
RUN mkdir -p /home/app
RUN chmod 777 -R /home/app
RUN chmod 777 -R /home/media
COPY *.jar /home/app/torrent.jar
COPY ./$CONFIG_DIR/config_files/transmission/ /var/lib/transmission/config
#COPY $CONFIG_DIR/commands/transmission/ /home/app
RUN chmod +X /home/app/*.sh
RUN openrc
RUN touch /run/openrc/softlevel
CMD echo 'rc_provide="loopback net"' >> /etc/rc.conf && \
    rc-service transmission-daemon stop && \
    rc-service transmission-daemon start && \
    java -jar /home/app/torrent.jar